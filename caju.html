<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<link rel="manifest" href="./manifest.webmanifest">
<body />
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Ubuntu+Condensed&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@mdi/font@5.9.55/css/materialdesignicons.min.css" rel="stylesheet">
<style>
  body {
    font-family: 'Ubuntu Condensed', sans-serif;
  }
</style>
<script>
  navigator.serviceWorker.register('sw.js');
</script>
<script type="module">
  import {
    Coluna,
    Livro,
    Página,
    Navegação,
    VisualizadorHTML,
    Texto,
    CampoDeTexto,
    BarraDeTopo,
    Espaço,
    Ícone,
    solicite_escolha,
  } from "./caju-aplicativo.js"
  import {
    Comando,
    Importe,
    Exporte,
    componentes,
    comandos_externos,
  } from "./caju.js"
  var leiaute = new Coluna(0, 0, 0)
  leiaute.largura = "100%"
  leiaute.altura = "100%"
  var topo
  leiaute.adicione(topo = new BarraDeTopo())
  var abrir
  topo.adicione(abrir = new Ícone("folder-open-outline"))
  abrir.ao_clicar(() => {
    var input = document.createElement("input")
    input.type = "file"
    input.click()
    input.addEventListener("change", evento => {
      var leitor = new FileReader()
      leitor.addEventListener("load", evento => {
        JSON.parse(evento.target.result).slice(1).map(comando => {
          coluna_código.adicione(new componentes[comando[0]](...comando.slice(1)))
        })
      })
      leitor.readAsText(evento.target.files[0])
    })
  })
  var salvar
  topo.adicione(salvar = new Ícone("content-save-outline"))
  salvar.ao_clicar(() => {
    var a = document.createElement("a")
    a.href = URL.createObjectURL(new Blob([JSON.stringify(["0.2.0", ...coluna_código.filhos.map(comando => comando.estruture())])], {type: "application/json"}))
    a.download = "projeto.caju"
    a.click()
  })
  topo.adicione(new Espaço())
  var deletar
  topo.adicione(deletar = new Ícone("delete"))
  deletar.ao_clicar(() => {
    if (Comando.selecionado !== undefined) {
      Comando.selecionado.pai.remova(Comando.selecionado)
      Comando.selecionado = undefined
    }
  })
  deletar.e.style.color = "#909090"
  Comando.ao_selecionar(() => deletar.e.style.color = "#FFFFFF")
  Comando.ao_desselecionar(() => deletar.e.style.color = "#909090")
  var adicionar
  topo.adicione(adicionar = new Ícone("plus"))
  adicionar.ao_clicar(() => {
    solicite_escolha([
      ["#d7ab32", "Aplicativo", "Aplicativo"],
      [Importe.cor, Importe.nome, Importe],
      [Exporte.cor, Exporte.nome, Exporte],
    ], Tipo => {
      if (Tipo == "Aplicativo") {
        var endereço = "https://cajueiro.herokuapp.com/angelonuffer/aplicativo/desenvolvimento/aplicativo.caju"
        coluna_código.adicione(new Importe([["CajuTipoTexto", endereço]]))
        Importe.ao_importar[endereço] = () => {
          comandos_externos.map(Comando => {
            if (Comando.nome == "Aplicativo") {
              coluna_código.adicione(new Comando())
            }
          })
        }
        return
      }
      coluna_código.adicione(new Tipo())
    })
  })
  var livro
  leiaute.adicione(livro = new Livro())
  livro.crescimento = 1
  livro.excesso = "rolar"
  livro.margem = 16
  var código
  livro.adicione(código = new Página())
  var coluna_código
  código.adicione(coluna_código = new Coluna(0, 0, 16))
  var navegação
  leiaute.adicione(navegação = new Navegação(["code-json", "eye"]))
  var página_pré_visualizar
  livro.adicione(página_pré_visualizar = new Página())
  página_pré_visualizar.crescimento = 1
  página_pré_visualizar.e.style.alignItems = ""
  var pré_visualizar
  página_pré_visualizar.adicione(pré_visualizar = new VisualizadorHTML())
  pré_visualizar.espessura_da_borda = 3
  navegação.ao_trocar((i) => {
    if (i == 0) {
      abrir.mostre()
      salvar.mostre()
      adicionar.mostre()
    }
    if (i == 1) {
      var globais = {
        "caju.saída": "",
      }
      coluna_código.filhos.map(comando => comando.avalie(globais))
      pré_visualizar.e.src = URL.createObjectURL(new Blob([globais["caju.saída"]], {type: "text/html"}))
      abrir.esconda()
      salvar.esconda()
      adicionar.esconda()
    }
    livro.vá.bind(livro)(i)
  })
  document.body.appendChild(leiaute.e)
  document.body.style.margin = 0
</script>
