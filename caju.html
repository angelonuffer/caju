<meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<link rel="manifest" href="./manifest.webmanifest">
<body>
  <span id="corpo">
    <span id="livro">
      <span class="página" id="arquivos">
        <span class="barra_de_topo">
          <span class="mdi mdi-file-plus-outline"></span>
          <span class="mdi mdi-github"></span>
        </span>
        <span id="lista_de_arquivos"></span>
      </span>
      <span class="página" id="código">
        <span class="barra_de_topo">
          <span class="mdi mdi-content-paste"></span>
          <span class="mdi mdi-plus"></span>
        </span>
        <span></span>
      </span>
      <span class="página" id="visualizar"></span>
    </span>
    <span id="barra_de_navegação">
      <span class="mdi mdi-file-cabinet"></span>
      <span class="mdi mdi-code-json"></span>
      <span class="mdi mdi-eye"></span>
    </span>
  </span>
</body>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Ubuntu+Condensed&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/@mdi/font@5.9.55/css/materialdesignicons.min.css" rel="stylesheet">
<style>
  body {
    font-family: 'Ubuntu Condensed', sans-serif;
    overflow-y: hidden;
    margin: 0;
  }
  #corpo {
    height: 100%;
    display: flex;
    flex-direction: column;
  }
  #livro {
    display: flex;
    flex-grow: 1;
  }
  .página {
    display: none;
    flex-direction: column;
    flex-grow: 1;
  }
  .barra_de_topo {
    background-color: #fd4659;
    color: #fff;
    font-size: 24px;
    display: flex;
    justify-content: flex-end;
  }
  .barra_de_topo span {
    padding: 12px;
  }
  #lista_de_arquivos {
    display: flex;
    flex-direction: column;
    font-size: 24px;
  }
  #lista_de_arquivos > span {
    display: flex;
    align-items: baseline;
  }
  #lista_de_arquivos span.ícone {
    padding: 12px;
  }
  #lista_de_arquivos span.nome {
    padding: 12px;
    flex-grow: 1;
  }
  #barra_de_navegação {
    background-color: #fd4659;
    color: #ffffffbf;
    font-size: 24px;
    display: flex;
  }
  #barra_de_navegação span {
    padding: 12px;
    flex-grow: 1;
    display: flex;
    justify-content: center;
  }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"
  integrity="sha512-GZ1RIgZaSc8rnco/8CXfRdCpDxRCphenIiZ2ztLy3XQfCbQUSCuk8IudvNHxkRA3oUg6q0qejgN/qqyG1duv5Q=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"
  integrity="sha512-szJ5FSo9hEmXXe7b5AUVtn/WnL8a5VofnFeYC2i2z03uS2LhAch7ewNLbl5flsEmTTimMN0enBZg/3sQ+YOSzQ=="
  crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
  var botões_de_navegação = [
    [
      document.querySelector("span.mdi-file-cabinet"),
      document.querySelector("span.página#arquivos"),
    ],
    [
      document.querySelector("span.mdi-code-json"),
      document.querySelector("span.página#código"),
    ],
    [
      document.querySelector("span.mdi-eye"),
      document.querySelector("span.página#visualizar"),
    ],
  ]
  botões_de_navegação.map(([botão, página]) => {
    botão.addEventListener("click", () => {
      botões_de_navegação.map(([botão, página]) => {
        botão.style.color = ""
        página.style.display = ""
      })
      botão.style.color = "#fff"
      página.style.display = "flex"
    })
  })
  botões_de_navegação[0][0].click()
  var descarregue_arquivo = (conteúdo) => {
    conteúdo = JSON.stringify(conteúdo)
    var endereço = "sha256:" + sha256(conteúdo)
    localStorage[endereço] = conteúdo
    return endereço
  }
  var carregue_arquivo = (endereço) => {
    return JSON.parse(localStorage[endereço])
  }
  if (localStorage["caju:raiz"] === undefined) {
    localStorage["caju:raiz"] = descarregue_arquivo([])
  }
  var span_lista_de_arquivos = document.querySelector("span#lista_de_arquivos")
  var atualize_lista_de_arquivos = () => {
    span_lista_de_arquivos.textContent = ""
    var raiz = carregue_arquivo(localStorage["caju:raiz"])
    raiz.forEach(([tipo, nome, endereço]) => {
      var span_arquivo = document.createElement("span")
      span_lista_de_arquivos.appendChild(span_arquivo)
      var span_ícone = document.createElement("span")
      span_arquivo.appendChild(span_ícone)
      span_ícone.classList.add("mdi")
      if (tipo == "arquivo") {
        span_ícone.classList.add("mdi-file-document-outline")
      }
      span_ícone.classList.add("ícone")
      var span_nome = document.createElement("span")
      span_arquivo.appendChild(span_nome)
      span_nome.classList.add("nome")
      span_nome.textContent = nome
    })
  }
  atualize_lista_de_arquivos()
  document.querySelector("span.mdi-file-plus-outline").addEventListener("click", () => {
    var nome = prompt("Nome do novo arquivo:")
    if (! nome.endsWith(".caju")) {
      nome += ".caju"
    }
    var endereço = descarregue_arquivo(["0.3.0"])
    var raiz = carregue_arquivo(localStorage["caju:raiz"])
    raiz.push(["arquivo", nome, endereço])
    localStorage["caju:raiz"] = descarregue_arquivo(raiz)
    atualize_lista_de_arquivos()
  })
</script>
